# Non-Fungible Career

## 東京大学 ブロックチェーンイノベーション寄附講座

### MOF グループリポジトリ

---

## 🚀 クイックスタート（初回セットアップ）

このリポジトリをクローンした後、以下のコマンドを実行して開発環境をセットアップしてください。

### 前提条件

- Node.js 18 以上
- npm または pnpm
- Git

### 1. リポジトリのクローン

```bash
git clone <repository-url>
cd career-passport
```

### 2. Foundry のインストール

```bash
# Foundry のインストールスクリプトをダウンロードして実行
curl -L https://foundry.paradigm.xyz | bash

# foundryup を実行（初回のみ）
foundryup
```

インストール後、ターミナルを再起動するか、以下のコマンドでパスを更新します：

```bash
source ~/.bashrc  # または source ~/.zshrc
```

**確認**:

```bash
forge --version
cast --version
anvil --version
```

### 3. コントラクトのセットアップ

```bash
# contracts ディレクトリに移動
cd contracts

# OpenZeppelin Contracts のインストール（既にインストール済みの場合はスキップ）
forge install OpenZeppelin/openzeppelin-contracts

# コントラクトのコンパイル
forge build
```

**確認**:

```bash
# コンパイルが成功したか確認
forge build
# テストを実行して動作確認
forge test
```

### 4. ローカルネットワーク（Anvil）の起動とデプロイ

**ターミナル 1**: Anvil を起動

```bash
cd contracts
anvil
```

Anvil が起動すると、以下のような情報が表示されます：

- 利用可能なアカウントとプライベートキー
- RPC URL: `http://localhost:8545`
- Chain ID: `31337`

**ターミナル 2**: コントラクトをデプロイ

```bash
cd contracts

# すべてのコントラクトを一度にデプロイ（推奨）
bash scripts/deploy-all.sh
```

このスクリプトは以下を実行します：

1. `CareerPassportNFT`をデプロイ
2. `StampManager`をデプロイ
3. デプロイ済みアドレスを`deployed.json`に自動保存
4. 環境変数ファイル（`frontend/.env.local`）を自動生成

**確認**:

```bash
# デプロイ済みアドレスを確認
cat deployed.json | jq .

# テストスクリプトを実行して動作確認
chmod +x scripts/test-deployment.sh
./scripts/test-deployment.sh
```

### 5. フロントエンドのセットアップ

**ターミナル 3**: フロントエンドを起動

```bash
# プロジェクトルートに戻る
cd ..

# フロントエンドディレクトリに移動
cd frontend

# 依存関係のインストール
npm install
# または
pnpm install

# 開発サーバーの起動
npm run dev
# または
pnpm dev
```

ブラウザで `http://localhost:5173` を開いて動作確認してください。

### 6. 環境構築の確認

すべてのセットアップが完了したら、以下を確認してください：

**コントラクト側**:

- ✅ `forge build` が成功する
- ✅ `forge test` が成功する
- ✅ `deployed.json` にコントラクトアドレスが記録されている
- ✅ `frontend/.env.local` が生成されている

**フロントエンド側**:

- ✅ `npm run dev` で開発サーバーが起動する
- ✅ ブラウザで `http://localhost:5173` にアクセスできる
- ✅ ウォレット接続画面が表示される

### トラブルシューティング

**Foundry がインストールされない場合**:

```bash
# パスを確認
echo $PATH

# foundryupを再実行
foundryup
```

**コントラクトのコンパイルエラー**:

```bash
# 依存関係を再インストール
cd contracts
forge install OpenZeppelin/openzeppelin-contracts --force
forge build
```

**Anvil に接続できない場合**:

```bash
# Anvilが起動しているか確認
curl http://localhost:8545

# ポートが使用されているか確認
lsof -i :8545
```

**詳細なトラブルシューティング**: [Day 4 テストとデプロイガイド](./DAY4_TEST_AND_DEPLOY_GUIDE.md) の「8. トラブルシューティング」セクションを参照

これで開発環境のセットアップが完了です。

---

## 📋 プロジェクト概要

Non-Fungible Career は、ユーザー（学生・転職者など）が企業からスタンプを集めて NFT 証明書を取得できるブロックチェーンアプリケーションです。

**主な機能**:

- 🎫 スタンプコレクション（企業からスタンプを取得）
- 🏆 NFT 証明書の取得（スタンプ 3 つで交換可能）
- 🔐 ゼロ知識証明（プライバシーを保護しながら証明）
- 📊 企業向けダッシュボード（スタンプ発行・統計管理）

---

## 📅 10 日実装プラン

### 全体スケジュール

```
Day 1-2:  UI実装（モックデータ）          ✅ 完了
Day 3-4:  スマートコントラクト実装         ✅ 完了
Day 5-6:  ウォレット連携と統合            ⏳ 次の作業
Day 7-8:  機能完成とテスト                📋 予定
Day 9-10: デモ準備と最終調整              📋 予定
```

---

## ✅ 現在の進捗ステータス

### 🎉 Day 1-2: UI 実装（完了）

**完了した作業**:

- ✅ **入り口画面** - ユーザー/企業の選択画面
- ✅ **WalletConnect 統合** - MetaMask によるウォレット接続認証
- ✅ **ユーザー向け UI** - 全ページの実装完了
- ✅ **企業向け UI** - 全ページの実装完了
- ✅ **VC 設計への移行** - 個人情報設定から VC 管理への変更
- ✅ **メッセージ UI 改善** - 個人情報を表示しない Web3 設計
- ✅ **デザイン** - グラデーション、カードベース、アニメーション
- ✅ **ローカルストレージ** - モックデータでの動作確認
- ✅ **ルーティング** - 全ページのルーティング設定完了
- ✅ **ナビゲーションバー** - 全ページへのリンク追加

**実装済みページ（個人ユーザー向け）**:

- `/` - 入り口（ユーザー/企業選択）
- `/student` - ユーザーホーム（ダッシュボード）
- `/student/mypage` - マイページ（スタンプコレクション）
- `/student/nfts` - NFT 証明書一覧
- `/student/nft/:id` - NFT 詳細
- `/student/events` - NFT 獲得イベント一覧
- `/student/events/:id/apply` - イベント応募
- `/student/job-conditions` - 求人条件設定
- `/student/job-search` - 求人探し
- `/student/matched-companies` - マッチング企業一覧
- `/student/messages` - メッセージ（個人情報非表示設計）
- `/student/settings` - VC 管理・ZKP（統合ページ）

**実装済みページ（企業ユーザー向け）**:

- `/org` - 企業ダッシュボード
- `/org/stamp-issuance` - スタンプ発行
- `/org/nfts` - NFT 証明書一覧
- `/org/nft/:id` - NFT 詳細
- `/org/events` - NFT 発行イベント一覧
- `/org/events/:id/collaborate` - イベント共同オファー
- `/org/recruitment-conditions` - 人材募集条件設定
- `/org/candidate-search` - 人材探し
- `/org/matched-candidates` - マッチング人材詳細
- `/org/messages` - メッセージ（個人情報非表示設計）
- `/org/settings` - 企業 VC 管理

**削除されたページ（WalletConnect 設計により不要）**:

- ❌ `/student/login` - WalletConnect 統合により不要
- ❌ `/student/register` - WalletConnect 統合により不要
- ❌ `/org/login` - WalletConnect 統合により不要
- ❌ `/org/register` - WalletConnect 統合により不要
- ❌ `/student/zk-proof` - `/student/settings`に統合
- ❌ `/student/vc-management` - `/student/settings`に統合

### 🎉 Day 3-4: スマートコントラクト実装（完了）

**完了した作業**:

- ✅ **Foundry セットアップ** - Foundry のインストールと確認
- ✅ **コントラクト実装** - CareerPassportNFT と StampManager の実装完了
- ✅ **ユニットテスト** - コントラクトのユニットテスト作成と実行
- ✅ **ローカルデプロイ** - Anvil へのデプロイ完了
- ✅ **デプロイスクリプト** - 自動デプロイスクリプトの作成
- ✅ **テストスクリプト** - 機能テストスクリプトの作成
- ✅ **ABI 取得** - コントラクト ABI の取得と保存
- ✅ **環境変数生成** - フロントエンド用環境変数の自動生成

**実装済みコントラクト**:

- `CareerPassportNFT.sol` - NFT 証明書発行コントラクト

  - mint 機能（所有者のみ）
  - トークン URI、名前、レアリティ、組織情報の管理
  - 譲渡禁止機能
  - 総供給量の取得

- `StampManager.sol` - スタンプ管理コントラクト
  - スタンプ発行機能（所有者のみ）
  - ユーザーごとのスタンプ管理
  - 組織別・カテゴリ別スタンプ数の集計
  - NFT 発行可能判定（同一組織から 3 つ以上）

**実装済みスクリプト**:

- `scripts/deploy-all.sh` - すべてのコントラクトを一度にデプロイ
- `scripts/save-deployed-addresses.sh` - デプロイ済みアドレスを自動記録
- `scripts/generate-env.sh` - フロントエンド用環境変数を自動生成
- `scripts/test-deployment.sh` - デプロイ済みコントラクトの機能テスト

**詳細手順書**: [Day 3 セットアップガイド](./DAY3_FOUNDRY_SETUP_GUIDE.md) | [Day 4 テストとデプロイガイド](./DAY4_TEST_AND_DEPLOY_GUIDE.md)

### 📋 スマートコントラクトの機能詳細

#### StampManager（スタンプ管理コントラクト）

**スタンプ発行・管理**:

- ✅ ユーザーへのスタンプ発行（所有者のみ実行可能）
- ✅ スタンプ情報の保存（ID、名前、組織、カテゴリ、発行日時）
- ✅ ユーザーごとのスタンプリスト取得
- ✅ ユーザーのスタンプ総数取得

**集計機能**:

- ✅ 組織別スタンプ数の取得
- ✅ カテゴリ別スタンプ数の取得
- ✅ 複数ユーザーの独立管理

**NFT 発行条件判定**:

- ✅ 同一組織から 3 スタンプ以上で NFT 発行可能か判定（基本ルール）
- ✅ 組織ごとの独立判定（異なる組織のスタンプは合算しない）

**ルールベースシステム**:

- ✅ カスタム NFT 発行ルールの追加
  - 例: 2 企業から各 3 スタンプ = Rare NFT
  - 例: 3 企業から各 3 スタンプ = Epic NFT
  - 例: 5 企業から各 3 スタンプ = Legendary NFT
- ✅ ルールの有効/無効切り替え
- ✅ ユーザーが特定のルールを満たしているかチェック
- ✅ ユーザーが満たせる全ルール ID の取得
- ✅ ルール情報の取得（レアリティ、必要企業数、企業あたりスタンプ数）
- ✅ 全ルール ID の取得

#### CareerPassportNFT（NFT 証明書コントラクト）

**NFT 発行**:

- ✅ NFT 証明書の発行（所有者のみ実行可能）
- ✅ メタデータの設定（URI、名前、レアリティ、関連組織）
- ✅ トークン ID の自動採番（0 から順番）

**NFT 情報取得**:

- ✅ トークン URI の取得
- ✅ トークン名の取得
- ✅ レアリティの取得
- ✅ 関連組織リストの取得
- ✅ 総供給量の取得

**セキュリティ機能**:

- ✅ 譲渡禁止（キャリア証明書は譲渡不可）
- ✅ 所有者への返却のみ許可
- ✅ バーン（削除）機能

**ERC721 標準準拠**:

- ✅ ERC721 標準インターフェース実装
- ✅ `ownerOf()`、`balanceOf()`などの標準関数
- ✅ メタデータ拡張対応

### ⚠️ 制限事項

**機能的な制限**:

- ❌ フロントエンドとの自動連携（Day 5-6 で実装予定）
- ❌ スタンプの削除・変更機能（現状は追加のみ）
- ❌ ルールの削除機能（無効化のみ可能）
- ❌ カテゴリベースのルール（組織ベースのみ対応）
- ❌ スタンプの有効期限機能
- ❌ NFT のアップグレード機能

**技術的な制限**:

- ❌ メインネットへのデプロイ（ローカルネットワークのみ）
- ❌ ガス最適化（現状は動作確認優先）
- ❌ アップグレード可能なコントラクト（現状は固定）
- ❌ マルチチェーン対応（単一チェーン対応のみ）

**運用上の制限**:

- ❌ 分散化されたスタンプ発行（現状は所有者のみ）
- ❌ 自動 NFT 発行（手動 mint のみ）
- ❌ スタンプの譲渡機能
- ❌ バッチ処理機能（複数スタンプ一括発行など）

### 🔄 現在の実装状況

**フロントエンド**:

- ✅ 全画面の UI 実装完了
- ✅ WalletConnect 統合完了
- ✅ VC 設計への移行完了
- ✅ メッセージ UI 改善完了（個人情報非表示）
- ✅ ナビゲーションバー実装完了
- ⏳ ブロックチェーン連携（未実装）
- ⏳ バックエンド API 連携（未実装）

**バックエンド**:

- ⏳ API 実装（未実装）
- ⏳ データベース設計（未実装）
- ⏳ イベント応募 API（未実装）
- ⏳ メッセージ API（未実装）
- ⏳ マッチング API（未実装）

**スマートコントラクト**:

- ✅ スタンプ発行コントラクト（StampManager）実装完了
- ✅ NFT 発行コントラクト（CareerPassportNFT）実装完了
- ✅ ユニットテスト実装完了
- ✅ ローカルネットワークへのデプロイ完了
- ✅ コントラクト ABI の取得と保存完了
- ✅ ルールベースシステム実装完了（複数企業対応、レアリティ管理）
- ⏳ フロントエンドとの連携（Day 5-6 で実装予定）

**Web3 設計**:

- ✅ WalletConnect 認証設計完了
- ✅ VC 管理設計完了
- ✅ プライバシー保護設計完了
- ✅ メッセージ設計完了（個人情報非表示）
- ✅ イベント・メッセージ・求人のやりとり設計完了（ハイブリッドアプローチ）
- ⏳ ZKP 実装（モックのみ）
- ⏳ VC 取得 API（モックのみ）

### 📊 実装完了率

- **フロントエンド UI**: 100% ✅
- **WalletConnect 統合**: 100% ✅
- **VC 設計**: 100% ✅
- **メッセージ UI**: 100% ✅
- **スマートコントラクト**: 100% ✅
- **コントラクトテスト**: 100% ✅
- **ローカルデプロイ**: 100% ✅
- **バックエンド API**: 0% ⏳
- **ブロックチェーン連携**: 0% ⏳（Day 5-6 で実装予定）
- **ZKP 実装**: 10% ⏳（モックのみ）
- **VC 取得 API**: 0% ⏳（モックのみ）

**全体進捗**: 約 60% 完了

---

## 🗺️ 画面遷移図

### 個人ユーザー向けフロー

```
トップページ (/)
    │
    └─→ ユーザー選択 → WalletConnect接続（MetaMask）
            │
            └─→ 個人トップ (/student)
                    │
                    ├─→ マイページ (/student/mypage)
                    │       └─→ スタンプコレクション表示
                    │
                    ├─→ NFT証明書一覧 (/student/nfts)
                    │       └─→ NFT詳細 (/student/nft/:id)
                    │
                    ├─→ NFT獲得イベント一覧 (/student/events)
                    │       └─→ イベント応募 (/student/events/:id/apply)
                    │
                    ├─→ 求人条件設定 (/student/job-conditions)
                    │       └─→ 求人探し (/student/job-search)
                    │               └─→ マッチング企業 (/student/matched-companies)
                    │                       └─→ メッセージ (/student/messages)
                    │                               └─→ VCから情報を選択的に開示
                    │
                    └─→ VC管理・ZKP (/student/settings)
                            ├─→ VC管理タブ
                            │   ├─→ マイナンバーカードVC追加（モック）
                            │   ├─→ 学位証明書VC追加（モック）
                            │   ├─→ TOEIC証明書VC追加（モック）
                            │   └─→ その他のVC追加（モック）
                            │
                            └─→ ゼロ知識証明タブ
                                ├─→ ZKP証明生成（モック）
                                └─→ ZKP証明検証（モック）
```

### 企業ユーザー向けフロー

```
トップページ (/)
    │
    └─→ 企業選択 → WalletConnect接続（MetaMask）
            │
            └─→ 企業トップ (/org)
                    │
                    ├─→ スタンプ発行 (/org/stamp-issuance)
                    │
                    ├─→ NFT証明書一覧 (/org/nfts)
                    │       └─→ NFT詳細 (/org/nft/:id)
                    │
                    ├─→ NFT発行イベント一覧 (/org/events)
                    │       └─→ イベント共同オファー (/org/events/:id/collaborate)
                    │
                    ├─→ 人材募集条件設定 (/org/recruitment-conditions)
                    │       └─→ 人材探し (/org/candidate-search)
                    │               └─→ マッチング人材詳細 (/org/matched-candidates)
                    │                       └─→ メッセージ (/org/messages)
                    │                               └─→ 候補者のウォレットアドレス表示
                    │                               └─→ 開示された情報のみ表示
                    │
                    └─→ 企業VC管理 (/org/settings)
                            ├─→ 法人登記証明書VC追加（モック）
                            ├─→ 税務証明書VC追加（モック）
                            ├─→ 業界認証VC追加（モック）
                            ├─→ ISO認証VC追加（モック）
                            └─→ その他のVC追加（モック）
```

### 主要な遷移パス

**個人ユーザー**:

- 入り口 → WalletConnect 接続 → ホーム → 各機能ページ
- 求人: 条件設定 → 求人探し → マッチング企業 → メッセージ
- イベント: イベント一覧 → イベント応募
- VC 管理: VC 追加 → ZKP 証明生成

**企業ユーザー**:

- 入り口 → WalletConnect 接続 → ダッシュボード → 各機能ページ
- 人材探し: 条件設定 → 人材探し → マッチング人材 → メッセージ
- イベント: イベント一覧 → イベント共同オファー
- VC 管理: VC 追加 → 企業情報の管理

### 削除された遷移パス

- ❌ `/student/login` → WalletConnect 統合により不要
- ❌ `/student/register` → WalletConnect 統合により不要
- ❌ `/org/login` → WalletConnect 統合により不要
- ❌ `/org/register` → WalletConnect 統合により不要
- ❌ `/student/zk-proof` → `/student/settings`に統合
- ❌ `/student/vc-management` → `/student/settings`に統合

---

## 📱 画面一覧と説明

### 個人ユーザー向け画面

#### 認証・設定

- **トップページ** (`/`)

  - ユーザー/企業の選択画面
  - ウォレット接続によるログイン

- **個人ログイン** (`/student/login`)

  - MetaMask などのウォレット接続による認証
  - Web3 設計：運営側は個人情報を持たない

- **VC 管理** (`/student/settings`)
  - VC（Verifiable Credential：検証可能な証明書）の管理
  - マイナンバーカード、学位証明書などの VC を外部から取得・保存
  - VC から必要な情報を選択的に開示可能
  - ユーザーが自分で入力する情報は不要（VC ベースの設計）
  - **注意**: 現時点ではマイナンバーカードや学位証明書の VC 形式は実証実験レベル（デジタル庁や一部大学で実証実験中）。現在の実装は将来的な VC 取得機能のモック

#### メイン機能

- **個人トップ** (`/student`)

  - ダッシュボード画面
  - スタンプ数、NFT 証明書数の表示
  - 次の目標の表示

- **所持 NFT 一覧** (`/student/nfts`)

  - 取得した NFT 証明書の一覧表示

- **各 NFT 確認** (`/student/nft/:id`)

  - NFT 証明書の詳細情報表示

- **NFT 獲得イベント一覧** (`/student/events`)

  - スタンプ獲得イベントの一覧
  - 応募可能なイベントを表示

- **各 NFT 獲得イベント応募** (`/student/events/:id/apply`)
  - イベントへの応募フォーム
  - 応募動機や経験を入力

#### 仕事探し機能

- **仕事応募条件設定** (`/student/job-conditions`)

  - 希望する仕事の条件を設定
  - インターンシップ/正社員の選択
  - スキル、勤務地、給与などの条件設定

- **インターン探し中/就職探し中** (`/student/job-search`)

  - 設定した条件に合った仕事の一覧
  - インターンシップと正社員を切り替え可能

- **条件マッチング企業画面** (`/student/matched-companies`)

  - 条件に合った企業の一覧
  - マッチ度の表示
  - ZKP で条件を証明する機能
  - プライバシー保護の説明

- **メッセージ** (`/student/messages`)
  - 企業とのメッセージ交換
  - 選択的な情報開示機能（Web3 設計）
  - 必要最小限の情報のみを開示可能

#### その他

- **マイページ** (`/student/mypage`)

  - スタンプコレクションの表示
  - 進捗状況の確認

- **ゼロ知識証明** (`/student/zk-proof`)
  - プライバシーを保護しながら条件を証明
  - 詳細情報を開示せずに条件を満たすことを証明可能

### 企業ユーザー向け画面

#### 認証・設定

- **企業ログイン** (`/org/login`)

  - MetaMask などのウォレット接続による認証
  - Web3 設計：運営側は企業情報を持たない

- **企業情報設定** (`/org/settings`)
  - 企業情報の入力・編集（完全任意）
  - ローカルストレージのみに保存
  - Web3 設計の説明を表示

#### メイン機能

- **企業トップ** (`/org`)

  - ダッシュボード画面
  - 発行済みスタンプ数、参加者数、NFT 発行数の統計

- **所持 NFT 一覧** (`/org/nfts`)

  - 発行した NFT 証明書の一覧表示

- **各 NFT 確認** (`/org/nft/:id`)

  - NFT 証明書の詳細情報表示

- **NFT 発行イベント** (`/org/events`)

  - NFT 獲得イベントの作成・管理
  - イベントの一覧表示

- **NFT 発行イベント共同オファー** (`/org/events/:id/collaborate`)

  - 他の企業と共同でイベントを開催
  - パートナー企業の選択

- **スタンプ発行** (`/org/stamp-issuance`)
  - ユーザーへのスタンプ発行機能

#### 人材探し機能

- **人材募集条件設定画面** (`/org/recruitment-conditions`)

  - 募集する人材の条件を設定
  - 必須スキル、歓迎スキル、勤務形態などの設定

- **人材探し画面** (`/org/candidate-search`)

  - 条件に合った人材の一覧
  - マッチ度の表示

- **条件マッチング画面** (`/org/matched-candidates`)

  - 条件に合った人材の詳細情報
  - 所持 NFT 証明書の確認

- **メッセージ** (`/org/messages`)
  - 候補者とのメッセージ交換

---

## 🔐 Web3 設計について

### プライバシー保護の設計

1. **自己主権型アイデンティティ**

   - 個人情報はユーザーのデバイスのローカルストレージのみに保存
   - 運営側のサーバーには一切送信されない

2. **ウォレット接続による認証**

   - メールアドレス/パスワードではなく、ウォレット接続で認証
   - ウォレットアドレスがユーザー識別子として機能

3. **ゼロ知識証明（ZKP）の活用**

   - **重要**: ZKP は<strong>VC（Verifiable Credential：検証可能な証明書）</strong>に対して使用されます
   - VC はローカルに保存された信頼できる発行者（企業、大学、試験機関など）が発行した証明書
   - 例：VC に「TOEIC 850 点」が含まれているが、「800 点以上」という条件を満たすことを証明（実際のスコアは開示しない）
   - **注意**: NFT 証明書はブロックチェーン上に公開されているため、そのまま見せれば良い（ZKP 不要）
   - 企業とのマッチング時、詳細な個人情報を開示せずに条件を満たすことを証明
   - プライバシーを保護しながらマッチングが可能

4. **選択的な情報開示**
   - メッセージ交換時、必要最小限の情報のみを選択的に開示
   - ユーザーが完全にコントロール

### データ管理

- **オンチェーン**: NFT 証明書、スタンプ情報（ブロックチェーン上に記録、公開情報）
- **オフチェーン（ローカル）**:
  - VC（Verifiable Credential：検証可能な証明書）- 信頼できる発行者が発行した証明書
  - 個人情報、企業情報（ユーザーのデバイスのみ）
- **運営側**: 一切の個人情報を保持しない

### イベント・メッセージ・求人のやりとりの設計

運営側が個人情報を持たない Web3 設計において、イベント応募、メッセージ交換、求人マッチングは**ハイブリッドアプローチ**を採用します。

#### 設計方針：プライバシー保護と実用性のバランス

**原則**:

- 運営側は**個人情報（名前、メールアドレス、生年月日など）を一切保持しない**
- ウォレットアドレスが唯一の識別子として機能
- メタデータ（ウォレットアドレス、イベント ID、タイムスタンプなど）のみを運営側のデータベースに保存

**完全 Web3 実装の課題**:

- ブロックチェーン上への保存はガス代がかかり、コストが高い
- IPFS は永続性の問題や検索の難しさがある
- XMTP などの Web3 メッセージングプロトコルはまだ普及段階
- オンチェーンマッチングは実装が複雑でコストが高い

**ハイブリッドアプローチの利点**:

- 実装が現実的で、パフォーマンスが良い
- コストが低い
- プライバシーは保護される（個人情報は運営側が持たない）
- 将来的に完全 Web3 実装に移行可能

#### 1. イベント応募の設計

- **識別方法**: ウォレットアドレスで応募者を識別

  - 運営側は個人情報（名前、メールアドレスなど）を保持しない
  - ウォレットアドレスが唯一の識別子として機能

- **応募情報の保存（現実的な設計）**:

  - **運営側のデータベース**に以下のメタデータのみを保存:
    - イベント ID
    - 応募者のウォレットアドレス
    - 応募日時
    - 応募動機（テキスト、運営側が保存するが個人情報ではない）
  - **個人情報は一切保存しない**（名前、メールアドレス、生年月日など）
  - 応募者の NFT 証明書はブロックチェーン上で確認可能（公開情報）

- **企業側の確認**:
  - 企業はウォレットアドレスで応募者を識別
  - 応募者の NFT 証明書はブロックチェーン上で確認可能（公開情報）
  - 必要に応じて、応募者にメッセージで追加情報を依頼

#### 2. メッセージ交換の設計

- **メッセージの保存（現実的な設計）**:

  - **運営側のデータベース**に以下のメタデータのみを保存:
    - 送信者のウォレットアドレス
    - 受信者のウォレットアドレス
    - メッセージ内容（テキスト、運営側が保存するが個人情報ではない）
    - 送信日時
    - メッセージ ID
  - **個人情報は一切保存しない**（名前、メールアドレスなど）
  - メッセージ交換時、ユーザーは VC から選択的に情報を開示可能
    - 例：名前、大学名、専攻などを選択的に開示
    - 開示情報はメッセージ本文に含まれるが、運営側は個人情報として認識しない（ユーザーが選択的に開示）

- **将来的な移行**:
  - 将来的には XMTP などの Web3 メッセージングプロトコルに移行可能
  - 現時点では実用性を優先

#### 3. 求人マッチングの設計

- **学生側の条件設定**:

  - 希望条件（給与、勤務地、スキルなど）は**ローカルストレージに保存**
  - 運営側には送信しない（プライバシー保護）

- **マッチングプロセス（現実的な設計）**:

  - **学生側**: ローカルストレージに保存された条件を基に、企業の募集条件と照合
  - **ZKP による条件証明**: 学生は VC から必要な属性（年齢、TOEIC スコア、学位など）を ZKP で証明
  - **運営側のデータベース**に以下のメタデータのみを保存:
    - マッチした学生のウォレットアドレス
    - マッチした企業のウォレットアドレス
    - マッチング日時
    - ZKP 証明のハッシュ（検証用）
  - **個人情報は一切保存しない**（条件の詳細、個人情報など）

- **企業側の確認**:
  - 企業はマッチした学生のウォレットアドレスを取得
  - 学生の NFT 証明書はブロックチェーン上で確認可能（公開情報）
  - 必要に応じて、メッセージで追加情報を依頼

#### 4. データベース設計の例

**運営側のデータベースに保存するデータ（個人情報なし）**:

- **イベント応募テーブル**:

  - `eventId` (イベント ID)
  - `walletAddress` (応募者のウォレットアドレス)
  - `applicationText` (応募動機、個人情報ではない)
  - `appliedAt` (応募日時)

- **メッセージテーブル**:

  - `messageId` (メッセージ ID)
  - `senderAddress` (送信者のウォレットアドレス)
  - `receiverAddress` (受信者のウォレットアドレス)
  - `content` (メッセージ内容、個人情報ではない)
  - `sentAt` (送信日時)

- **マッチングテーブル**:
  - `matchId` (マッチング ID)
  - `studentAddress` (学生のウォレットアドレス)
  - `orgAddress` (企業のウォレットアドレス)
  - `zkpProofHash` (ZKP 証明のハッシュ、検証用)
  - `matchedAt` (マッチング日時)

**運営側のデータベースに保存しないデータ（個人情報）**:

- 名前、メールアドレス、生年月日、住所、電話番号
- VC の詳細内容（ローカルストレージのみ）
- 求人条件の詳細（ローカルストレージのみ）

#### 5. プライバシー保護の確認

- **運営側が保持するデータ**: ウォレットアドレス、メタデータ（イベント ID、タイムスタンプなど）、メッセージ内容（テキスト、個人情報ではない）
- **運営側が保持しないデータ**: 個人情報（名前、メールアドレス、生年月日など）、VC の詳細内容、求人条件の詳細
- **ユーザーのコントロール**: ユーザーはメッセージで選択的に情報を開示可能
- **将来的な移行**: 完全 Web3 実装（XMTP、IPFS、オンチェーンマッチング）への移行も可能

### ZKP と VC の関係

- **NFT 証明書**: ブロックチェーン上に公開されているため、そのまま見せれば良い（ZKP 不要）
- **VC（Verifiable Credential）**: ローカルに保存された証明書。詳細情報を含むが、ZKP で選択的に開示可能
  - 例：VC に「TOEIC 850 点」が含まれているが、「800 点以上」という条件を満たすことを証明（実際のスコアは開示しない）
  - 例：VC に「年齢 26 歳」が含まれているが、「25 歳以上」という条件を満たすことを証明（実際の年齢は開示しない）

### VC の現状について

- **マイナンバーカード**: デジタル庁が実証実験を実施中。VC 形式での発行は実証実験レベル（2024-2025 年時点）
- **学位証明書**: 一部の大学（NII、近畿大学など）で実証実験が進行中。まだ一般的ではない
- **現在の実装**: 将来的な VC 取得機能のモックとして実装。実際の VC 取得 API は未実装
- **将来の展望**: 政府や大学が VC 形式での証明書発行を本格化する予定

---

**技術スタック**:

- React 19 + Vite 6
- Tailwind CSS
- React Router
- Ethers.js（準備済み）

**現在の状態**:

- ✅ フロントエンド UI は完全に動作
- ✅ ローカルストレージでデータ管理
- ⏳ ブロックチェーン連携は未実装（次のフェーズで実装予定）

---

### ✅ Day 3-4: スマートコントラクト実装（完了）

**目標**: ブロックチェーン機能を実装し、ローカルネットワークで動作確認

**作業チェックリスト**:

#### Day 3: Foundry セットアップとコントラクト確認

- [x] Foundry のインストール確認
- [x] `contracts/` ディレクトリの確認
- [x] 既存コントラクトの確認
  - [x] `CareerPassportNFT.sol` の確認
  - [x] `StampManager.sol` の確認
- [x] コントラクトのコンパイル
- [x] ローカルネットワーク（Anvil）の起動
- [x] コントラクトのデプロイスクリプト確認
  - [x] `DeployNFT.s.sol` の確認
  - [x] `DeployStamp.s.sol` の確認

**詳細手順書**: [Day 3 セットアップガイド](./DAY3_FOUNDRY_SETUP_GUIDE.md)

#### Day 4: コントラクトのテストとデプロイ

- [x] コントラクトのユニットテスト作成
- [x] テストの実行と確認
- [x] ローカルネットワークへのデプロイ
- [x] デプロイされたコントラクトアドレスの記録
- [x] コントラクト ABI の取得と保存
- [x] 基本的な機能テスト（スタンプ発行、NFT 発行など）
- [x] テストスクリプトの作成（`scripts/test-deployment.sh`）

**詳細手順書**: [Day 4 テストとデプロイガイド](./DAY4_TEST_AND_DEPLOY_GUIDE.md)

**成果物**:

- ✅ 動作するスマートコントラクト
- ✅ ローカルネットワークでのデプロイ済みコントラクト
- ✅ コントラクト ABI ファイル
- ✅ ユニットテスト（CareerPassportNFT、StampManager）
- ✅ デプロイスクリプト（`deploy-all.sh`）
- ✅ テストスクリプト（`test-deployment.sh`）
- ✅ デプロイ済みアドレス記録スクリプト（`save-deployed-addresses.sh`）
- ✅ 環境変数生成スクリプト（`generate-env.sh`）

**参考ドキュメント**: [実装手順書（詳細）](./IMPLEMENTATION_GUIDE_10DAYS_DETAILED.md) の Day 3-4 セクション

---

### ⏳ Day 5-6: ウォレット連携と統合（次の作業）

**目標**: UI とブロックチェーンを接続し、実際にトランザクションを実行できるようにする

**作業チェックリスト**:

#### Day 5: MetaMask 連携

- [ ] MetaMask 接続機能の実装
- [ ] ウォレットアドレスの取得
- [ ] ネットワーク設定（ローカルネットワーク）
- [ ] コントラクトインスタンスの作成
- [ ] トランザクション送信の基本実装

#### Day 6: UI とブロックチェーンの統合

- [ ] スタンプ発行機能のブロックチェーン連携
- [ ] NFT 交換機能のブロックチェーン連携
- [ ] ローカルストレージとブロックチェーンの同期
- [ ] エラーハンドリングの実装
- [ ] ローディング状態の表示

**成果物**:

- ✅ MetaMask で接続可能
- ✅ ブロックチェーン経由でスタンプ発行可能
- ✅ ブロックチェーン経由で NFT 交換可能

---

### 📋 Day 5-6: バックエンド API 実装（予定）

**目標**: イベント、メッセージ、マッチング機能のバックエンド API を実装

**作業チェックリスト**:

- [ ] データベース設計（DynamoDB）
  - [ ] イベント応募テーブル設計
  - [ ] メッセージテーブル設計
  - [ ] マッチングテーブル設計
- [ ] バックエンド API 実装
  - [ ] イベント応募 API（ウォレットアドレスベース）
  - [ ] メッセージ API（ウォレットアドレスベース）
  - [ ] マッチング API（ウォレットアドレスベース）
- [ ] フロントエンドとバックエンドの統合
- [ ] エラーハンドリングの実装
- [ ] セキュリティ対策の実装

### 📋 Day 7-8: 機能完成とテスト（予定）

**目標**: すべての機能を完成させ、統合テストを実施

**作業チェックリスト**:

- [ ] ゼロ知識証明の実装（本格版）
  - [ ] ZKP ライブラリの選定・統合
  - [ ] VC ベースの ZKP 実装
  - [ ] マッチング時の ZKP 証明機能
- [ ] エラーハンドリングの強化
- [ ] UI/UX の改善
- [ ] 統合テストの実施
  - [ ] フロントエンド・バックエンド・ブロックチェーンの統合テスト
  - [ ] エッジケースのテスト
- [ ] バグ修正
- [ ] パフォーマンス最適化
- [ ] セキュリティ監査

---

### 📋 Day 9-10: デモ準備と最終調整（予定）

**目標**: デモ用の準備と最終調整

**作業チェックリスト**:

- [ ] デモ用データの準備
  - [ ] モック VC データの準備
  - [ ] モック NFT データの準備
  - [ ] モックメッセージデータの準備
- [ ] プレゼン資料の作成
  - [ ] Web3 設計の説明資料
  - [ ] プライバシー保護の説明資料
  - [ ] VC と ZKP の説明資料
- [ ] デモシナリオの作成
  - [ ] 個人ユーザーのデモフロー
  - [ ] 企業ユーザーのデモフロー
  - [ ] メッセージ機能のデモ
  - [ ] ZKP 機能のデモ
- [ ] 最終的な UI/UX 調整
- [ ] ドキュメントの整備
  - [ ] API 仕様書の作成
  - [ ] データベース設計書の作成
  - [ ] スマートコントラクト仕様書の作成

### 🔮 将来の拡張予定

**VC 取得 API の実装**:

- [ ] マイナンバーカード VC 取得 API（政府 API 統合）
- [ ] 学位証明書 VC 取得 API（大学 API 統合）
- [ ] TOEIC 証明書 VC 取得 API（試験機関 API 統合）
- [ ] 法人登記証明書 VC 取得 API（法務省 API 統合）
- [ ] 税務証明書 VC 取得 API（税務署 API 統合）

**完全 Web3 実装への移行**:

- [ ] XMTP などの Web3 メッセージングプロトコルへの移行
- [ ] IPFS へのデータ保存
- [ ] オンチェーンマッチングの実装
- [ ] 完全な ZKP 実装

**機能拡張**:

- [ ] 複数ウォレット対応
- [ ] マルチチェーン対応
- [ ] モバイルアプリ対応
- [ ] 多言語対応

---

## 🚀 クイックスタート

### 1. フロントエンドの起動

```bash
cd frontend
npm install
npm run dev
```

ブラウザで http://localhost:5173 を開く

### 2. 動作確認

1. **入り口画面**で「ユーザー」または「企業」を選択
2. **ユーザー向け**: スタンプコレクション、NFT 証明書、ゼロ知識証明を確認
3. **企業向け**: ダッシュボードからスタンプを発行

---

## 📚 実装手順書

詳細な実装手順は以下のドキュメントを参照：

- **[実装手順書（詳細）](./IMPLEMENTATION_GUIDE_10DAYS_DETAILED.md)**: 10 日で実装する詳細な手順書
- **[設計書](./DESIGN.md)**: システムアーキテクチャ、データフロー、UI/UX 設計

---

## 📁 プロジェクト構成

```
career-passport/
├── frontend/              # フロントエンド（React + Vite）
│   ├── src/
│   │   ├── pages/         # ページコンポーネント
│   │   ├── components/    # 共通コンポーネント
│   │   ├── lib/           # ユーティリティ
│   │   ├── data/          # モックデータ
│   │   └── abis/          # コントラクト ABI
│   │       ├── CareerPassportNFT.json
│   │       └── StampManager.json
│   ├── .env.local         # 環境変数（自動生成）
│   └── package.json
├── contracts/             # スマートコントラクト（Foundry）
│   ├── src/
│   │   ├── CareerPassportNFT.sol
│   │   └── StampManager.sol
│   ├── test/
│   │   ├── CareerPassportNFT.t.sol
│   │   └── StampManager.t.sol
│   ├── script/
│   │   ├── DeployNFT.s.sol
│   │   └── DeployStamp.s.sol
│   ├── scripts/
│   │   ├── deploy-all.sh              # 全コントラクトデプロイ
│   │   ├── save-deployed-addresses.sh  # アドレス記録
│   │   ├── generate-env.sh             # 環境変数生成
│   │   └── test-deployment.sh          # 機能テスト
│   ├── deployed.json       # デプロイ済みアドレス（自動生成）
│   └── foundry.toml
├── DAY3_FOUNDRY_SETUP_GUIDE.md         # Day 3 セットアップガイド
├── DAY4_TEST_AND_DEPLOY_GUIDE.md       # Day 4 テストとデプロイガイド
├── IMPLEMENTATION_GUIDE_10DAYS_DETAILED.md  # 詳細手順書
└── DESIGN.md                            # 設計書
```

---

## 🚀 これからの進め方

### 次の作業: Day 5-6 ウォレット連携と統合

**目標**: UI とブロックチェーンを接続し、実際にトランザクションを実行できるようにする

**今すぐ始める手順**:

1. **現在の環境を確認**

   ```bash
   # コントラクトがデプロイされているか確認
   cd contracts
   cat deployed.json | jq .

   # フロントエンドの環境変数が設定されているか確認
   cd ../frontend
   cat .env.local
   ```

2. **MetaMask の設定**

   - MetaMask をインストール
   - ローカルネットワーク（Anvil）を追加
     - ネットワーク名: `Anvil Local`
     - RPC URL: `http://localhost:8545`
     - Chain ID: `31337`
     - 通貨記号: `ETH`

3. **ウォレット接続機能の実装**

   - Ethers.js を使用して MetaMask と接続
   - コントラクトインスタンスの作成
   - トランザクション送信の実装

4. **UI とブロックチェーンの統合**

   - スタンプ発行機能のブロックチェーン連携
   - NFT 交換機能のブロックチェーン連携
   - エラーハンドリングの実装

**詳細な手順**: [実装手順書（詳細）](./IMPLEMENTATION_GUIDE_10DAYS_DETAILED.md) の Day 5-6 セクションを参照

---

### 進捗管理の方法

**各フェーズ完了時の確認事項**:

1. ✅ チェックリストのすべての項目が完了しているか
2. ✅ 動作確認ができているか
3. ✅ エラーが発生していないか
4. ✅ 次のフェーズに進む準備ができているか

**進捗の記録**:

- 各フェーズのチェックリストを更新
- 完了した項目にチェックを入れる
- 問題が発生した場合は、README に記録

---

### トラブルシューティング

**よくある問題**:

1. **Foundry がインストールされていない**

   ```bash
   curl -L https://foundry.paradigm.xyz | bash
   foundryup
   ```

2. **コントラクトのコンパイルエラー**

   - コントラクトファイルの構文を確認
   - 依存関係が正しくインストールされているか確認

3. **ローカルネットワークに接続できない**
   - Anvil が起動しているか確認
   - ポート番号（8545）が正しいか確認

詳細は [実装手順書（詳細）](./IMPLEMENTATION_GUIDE_10DAYS_DETAILED.md) を参照してください。

---

## 📝 重要な注意事項

### 現在の実装状態

- ✅ **フロントエンド UI**: 完全に動作（ローカルストレージ使用）
- ✅ **スマートコントラクト**: 実装完了、ローカルネットワークで動作確認済み
- ✅ **コントラクトテスト**: ユニットテスト実装完了
- ✅ **デプロイスクリプト**: 自動デプロイとアドレス記録完了
- ⏳ **ブロックチェーン連携**: 未実装（Day 5-6 で実装予定）
- ⏳ **データ管理**: ローカルストレージのみ（一時的）
- ⏳ **ウォレット連携**: 未実装（Day 5-6 で実装予定）

### データ管理の方針

**Phase 1（Day 1-2）**: ✅ 完了

- ローカルストレージのみで動作
- モックデータで動作確認

**Phase 2（Day 3-4）**: ✅ 完了

- スマートコントラクトの実装完了
- ローカルネットワークでの動作確認完了
- デプロイスクリプトとテストスクリプトの作成完了

**Phase 3（Day 5-6）**: ⏳ 次の作業

- ウォレット連携の実装
- ブロックチェーン経由でデータ管理
- ローカルストレージはキャッシュとして使用

**Phase 4 以降（Day 7-10）**: 📋 予定

- バックエンド API 実装
- 機能完成とテスト
- デモ準備と最終調整

---

## 📚 参考ドキュメント

- **[実装手順書（詳細）](./IMPLEMENTATION_GUIDE_10DAYS_DETAILED.md)**: 10 日で実装する詳細な手順書
- **[実装手順書（概要）](./IMPLEMENTATION_GUIDE_10DAYS.md)**: 10 日プランの概要
- **[設計書](./DESIGN.md)**: システムアーキテクチャ、データフロー、UI/UX 設計

---

---

## 🎯 主要な機能フロー

### スタンプ獲得から NFT 証明書取得まで

1. ユーザーがウォレット接続でログイン
2. NFT 獲得イベント一覧からイベントを選択
3. イベントに応募
4. 企業がスタンプを発行（ブロックチェーン上に記録）
5. スタンプを 3 つ集めると NFT 証明書に交換可能
6. NFT 証明書を取得（ブロックチェーン上に記録）

### 仕事探しからマッチングまで

1. 仕事応募条件を設定
2. 条件に合った仕事を検索
3. 条件マッチング企業画面で企業を確認
4. ZKP で条件を満たすことを証明（VC から選択的に開示）
5. メッセージ交換時に VC から必要最小限の情報のみを選択的に開示
6. マッチング成立

### 企業側の人材探し

1. 人材募集条件を設定
2. 条件に合った人材を検索
3. 候補者の所持 NFT 証明書を確認
4. メッセージで連絡
5. マッチング成立

---

**最終更新**: 2025 年 12 月 10 日（Day 4 完了）
